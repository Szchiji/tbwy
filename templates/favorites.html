<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„æ”¶è— - Matrix Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #0a0a12; }
        .card-bg { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); }
        .nav-bg { background: linear-gradient(90deg, #0f0f1a 0%, #1a1a2e 100%); }
        .navbar-bottom { background: linear-gradient(180deg, #0f0f1a 0%, #1a1a2e 100%); }
        .nav-item-active { color: #60a5fa; border-top: 2px solid #60a5fa; }
        .nav-item { color: #9ca3af; border-top: 2px solid transparent; }
    </style>
    <script>
        function getUserId() {
            let userId = localStorage.getItem('user_id');
            if (!userId) {
                userId = 'user_' + Math.random().toString(36).substring(2, 11);
                localStorage.setItem('user_id', userId);
            }
            return userId;
        }
        
        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            if (!urlParams.has('user_id')) {
                urlParams.set('user_id', getUserId());
                window.location.search = urlParams.toString();
            }
        };
    </script>
</head>
<body class="min-h-screen text-white pb-20">
    <!-- å¯¼èˆªæ  -->
    <nav class="nav-bg shadow-lg p-4 sticky top-0 z-50 border-b border-white/5">
        <div class="container mx-auto">
            <a href="/?user_id={{ user_id }}" class="text-2xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-500 italic tracking-wider">MATRIX HUB</a>
        </div>
    </nav>

    <!-- å…¬å‘Š -->
    {% if notice %}
    <div class="bg-gradient-to-r from-blue-900/30 to-purple-900/30 text-white p-3 text-sm font-medium border-b border-white/10">
        <div class="container mx-auto">{{ notice }}</div>
    </div>
    {% endif %}

    <!-- å†…å®¹åŒºåŸŸ -->
    <main class="container mx-auto px-4 py-6">
        <h1 class="text-2xl font-bold mb-6 text-blue-400">æˆ‘çš„æ”¶è—</h1>
        
        {% if posts %}
        <div class="space-y-4">
            {% for post in posts %}
            <div class="card-bg rounded-2xl overflow-hidden shadow-xl hover:shadow-2xl transition cursor-pointer flex border border-white/5" 
                 onclick="location.href='/post/{{ post.id }}?user_id={{ user_id }}'">
                
                <!-- å·¦ä¾§åª’ä½“åŒºåŸŸ -->
                <div class="relative w-36 h-36 flex-shrink-0 bg-gray-900">
                    {% set media = post.first_media or '' %}
                    {% set is_video = media.endswith('.mp4') or media.endswith('.mov') or media.endswith('.MP4') or media.endswith('.MOV') %}
                    {% set is_image = media.endswith('.jpg') or media.endswith('.jpeg') or media.endswith('.png') or media.endswith('.gif') or media.endswith('.webp') or media.endswith('.JPG') or media.endswith('.JPEG') or media.endswith('.PNG') %}
                    
                    {% if media and is_video %}
                    <!-- è§†é¢‘ç¼©ç•¥å›¾ -->
                    <div class="video-container w-full h-full relative">
                        {% if post.thumbnail %}
                        <img src="{{ post.thumbnail }}" class="w-full h-full object-cover" alt="Video thumbnail">
                        {% else %}
                        <div class="w-full h-full flex items-center justify-center bg-gray-800">
                            <span class="text-gray-500 text-xs">è§†é¢‘</span>
                        </div>
                        {% endif %}
                    </div>
                    {% elif media and is_image %}
                    <!-- å›¾ç‰‡ -->
                    <img src="{{ media }}" class="w-full h-full object-cover" 
                         onerror="this.onerror=null; this.parentElement.innerHTML='<div class=\'w-full h-full flex items-center justify-center bg-gray-800 text-gray-500 text-xs\'>NO MEDIA</div>'">
                    {% elif media %}
                    <!-- æœªçŸ¥åª’ä½“ç±»å‹ -->
                    <img src="{{ media }}" class="w-full h-full object-cover" 
                         onerror="this.onerror=null; this.parentElement.innerHTML='<div class=\'w-full h-full flex items-center justify-center bg-gray-800 text-gray-500 text-xs\'>NO MEDIA</div>'">
                    {% else %}
                    <!-- æ— åª’ä½“ -->
                    <div class="w-full h-full flex items-center justify-center bg-gray-800">
                        <span class="text-gray-500 text-xs font-medium">NO MEDIA</span>
                    </div>
                    {% endif %}
                </div>

                <!-- å³ä¾§æ–‡å­—åŒºåŸŸ -->
                <div class="flex-1 p-4 flex flex-col justify-start min-w-0">
                    <div class="text-blue-400 text-xs font-bold mb-2 text-left">{{ post.date }}</div>
                    <div class="text-gray-300 text-sm leading-relaxed line-clamp-4 whitespace-pre-wrap text-left w-full">
                        {{ post.text if post.text else 'æŸ¥çœ‹è¯¦æƒ…' }}
                    </div>
                    <div class="flex items-center gap-3 mt-auto pt-2 text-xs text-gray-500">
                        <span class="text-pink-400">â¤ï¸ {{ post.likes }}</span>
                        {% if post.blacklist_count %}
                        <span>ğŸš« {{ post.blacklist_count }}</span>
                        {% endif %}
                        <span class="text-yellow-400">â­ å·²æ”¶è—</span>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="text-center py-20">
            <div class="text-6xl mb-4">â­</div>
            <p class="text-gray-400 text-lg">è¿˜æ²¡æœ‰æ”¶è—ä»»ä½•å†…å®¹</p>
            <a href="/?user_id={{ user_id }}" class="inline-block mt-6 px-6 py-3 bg-blue-600 hover:bg-blue-700 rounded-xl text-white font-medium transition">
                å»é¦–é¡µçœ‹çœ‹
            </a>
        </div>
        {% endif %}
    </main>

    <!-- åº•éƒ¨å¯¼èˆªæ  -->
    <nav class="navbar-bottom fixed bottom-0 left-0 right-0 border-t border-white/10 shadow-2xl">
        <div class="flex justify-around items-center h-16">
            <a href="/?user_id={{ user_id }}" class="nav-item flex-1 flex flex-col items-center justify-center h-full transition hover:bg-white/5">
                <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                </svg>
                <span class="text-xs">é¦–é¡µ</span>
            </a>
            <a href="/favorites?user_id={{ user_id }}" class="nav-item-active flex-1 flex flex-col items-center justify-center h-full transition">
                <svg class="w-6 h-6 mb-1" fill="currentColor" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>
                </svg>
                <span class="text-xs font-bold">æ”¶è—</span>
            </a>
            <a href="/profile?user_id={{ user_id }}" class="nav-item flex-1 flex flex-col items-center justify-center h-full transition hover:bg-white/5">
                <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                </svg>
                <span class="text-xs">æˆ‘çš„</span>
            </a>
        </div>
    </nav>
</body>
</html>
